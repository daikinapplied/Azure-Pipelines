{"tasks":[{"environment":{},"displayName":"Taking site offline","alwaysRun":false,"continueOnError":false,"condition":"succeeded()","enabled":true,"timeoutInMinutes":0,"inputs":{"targetType":"inline","filePath":"","arguments":"","script":"Write-Host \"Taking existing site offline...\"\n$fileToCreate =  (join-path -path $(deploymentDirectory) -childpath \"app_offline.htm\")\nWrite-Host \"Creating file $fileToCreate\"\nNew-Item $fileToCreate -Force -ItemType \"file\" -value \"<html>$(htmlContent)</html>\"\nStart-Sleep -s 3\n","errorActionPreference":"stop","failOnStderr":"false","ignoreLASTEXITCODE":"false","pwsh":"false","workingDirectory":""},"task":{"id":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","versionSpec":"2.*","definitionType":"task"}},{"environment":{},"displayName":"Deploying files with Robocopy","alwaysRun":false,"continueOnError":false,"condition":"succeeded()","enabled":true,"timeoutInMinutes":0,"inputs":{"targetType":"inline","filePath":"","arguments":"","script":"robocopy \"$(publishSourceDirectory)\" \"$(deploymentDirectory)\" $(roboCopyParameters)\n\n#exit codes 0-7 from robocopy don't represent errors so this will only return the exit code if it is > 7\n#see https://support.microsoft.com/en-us/help/954404/return-codes-that-are-used-by-the-robocopy-utility-in-windows-server-2 for details.\n\nif ($LastExitCode -gt 7) {\n    # an error occurred\n    exit $LastExitCode\n}\nexit 0","errorActionPreference":"stop","failOnStderr":"false","ignoreLASTEXITCODE":"true","pwsh":"false","workingDirectory":""},"task":{"id":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","versionSpec":"2.*","definitionType":"task"}},{"environment":{},"displayName":"Bringing site back online","alwaysRun":false,"continueOnError":false,"condition":"succeeded()","enabled":true,"timeoutInMinutes":0,"inputs":{"targetType":"inline","filePath":"","arguments":"","script":"Write-Host\nWrite-Host \"Bring site online...\"\n\nif (Test-Path \"$(deploymentDirectory)\\app_offline.htm\")\n{\n   Remove-Item \"$(deploymentDirectory)\\app_offline.htm\"\n}\n","errorActionPreference":"stop","failOnStderr":"false","ignoreLASTEXITCODE":"false","pwsh":"false","workingDirectory":""},"task":{"id":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","versionSpec":"2.*","definitionType":"task"}}],"runsOn":["Agent","DeploymentGroup"],"revision":1,"createdBy":{"displayName":"Hans Dickel","id":"d9aac215-d8dd-4cf1-99d4-0d0769bfe7e2","uniqueName":"Hans.Dickel@daikinapplied.com"},"createdOn":"2020-05-13T12:41:28.463Z","modifiedBy":{"displayName":"Hans Dickel","id":"d9aac215-d8dd-4cf1-99d4-0d0769bfe7e2","uniqueName":"Hans.Dickel@daikinapplied.com"},"modifiedOn":"2020-05-13T12:41:28.463Z","id":"973dcafc-6579-4c1d-8478-0ba00500f704","name":"IIS - Publish .NET using Robocopy","version":{"major":1,"minor":0,"patch":0,"isTest":false},"iconUrl":"https://cdn.vsassets.io/v/M168_20200430.2/_content/icon-meta-task.png","friendlyName":"IIS - Publish .NET using Robocopy","description":"Publishes an IIS hosted .NET Core and .NET Framework application using Robocopy.  This will take the site offline, publish the files, and then bring the site back online.","category":"Deploy","definitionType":"metaTask","author":"Stafford, Chad D.","demands":[],"groups":[],"inputs":[{"aliases":[],"options":{},"properties":{},"name":"deploymentDirectory","label":"deploymentDirectory","defaultValue":"","required":true,"type":"string","helpMarkDown":"The directory where the files will be deployed to.","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"htmlContent","label":"htmlContent","defaultValue":"Offline for updates...","required":true,"type":"string","helpMarkDown":"HTML message to be displayed while the site is offline.","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"publishSourceDirectory","label":"publishSourceDirectory","defaultValue":"","required":true,"type":"string","helpMarkDown":"Source directory of the files to be published.","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"roboCopyParameters","label":"roboCopyParameters","defaultValue":"/PURGE /S /XF app_offline.htm /XD logs /NP /R:4 /W:15","required":true,"type":"string","helpMarkDown":"Robocopy command line parameters","groupName":""}],"satisfies":[],"sourceDefinitions":[],"dataSourceBindings":[],"instanceNameFormat":"Task group: IIS - Publish .NET using Robocopy $(deploymentDirectory)","preJobExecution":{},"execution":{},"postJobExecution":{}}